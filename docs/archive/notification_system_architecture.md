# 알림 시스템 아키텍처 개선 논의

## 현황 (AS-IS)

- **API 서비스**: 알림 조건 충족 시, Redis의 `notifications` 채널에 `{"chat_id": ..., "text": ...}`와 같이 텔레그램에 종속적인 메시지를 발행합니다.
- **Worker 서비스**: `notifications` 채널을 구독하고, 메시지를 수신하면 `send_telegram_message` 함수를 직접 호출하여 텔레그램 메시지를 발송합니다.
- **문제점**: 현재 구조는 알림 채널이 텔레그램으로 하드코딩되어 있어, 이메일, SMS, 디스코드 등 다른 채널로 확장하기가 어렵습니다.

## 개선 방향 (TO-BE)

> **목표**: 특정 채널에 종속되지 않는 유연하고 확장 가능한 알림 시스템을 구축합니다.

1.  **알림 메시지 형식 일반화**
    *   API가 Redis에 발행하는 메시지 형식을 특정 채널의 정보(`chat_id`) 대신, 일반적인 정보(`user_id`)를 담도록 변경합니다.
    *   **예시:** `{"user_id": 123, "message": "알림 내용"}`

2.  **Worker의 역할 변경: 알림 라우터 (Notification Router/Dispatcher)**
    *   Worker는 일반화된 메시지를 수신합니다.
    *   메시지의 `user_id`를 기반으로 DB에서 해당 사용자의 **개인 알림 설정**을 조회합니다. (예: `User.notification_preferences = {"telegram": True, "email": False}`)
    *   사용자가 활성화한 모든 채널에 대해 알림을 발송합니다. 이를 위해 Worker 내부에 각 채널별 전송 모듈을 둡니다.
        *   `send_telegram_notification(...)`
        *   `send_email_notification(...)`
        *   `send_discord_notification(...)`

3.  **API의 역할: 사용자 알림 설정 관리**
    *   사용자가 자신의 알림 수신 채널(텔레그램, 이메일 등)을 선택하고 설정할 수 있는 API 엔드포인트를 제공합니다.

## 기대 효과

- **확장성**: 새로운 알림 채널(예: SMS)이 추가될 때, API 서비스의 수정 없이 Worker 서비스에 새로운 전송 모듈만 추가하면 되므로 확장이 매우 용이합니다.
- **유연성**: 사용자는 자신이 선호하는 채널로만 알림을 받을 수 있어, 개인화된 서비스를 제공할 수 있습니다.
- **관심사 분리**: API는 비즈니스 로직에, Worker는 알림 전송 메커니즘에만 집중하여 시스템 구조가 더 명확해지고 유지보수가 쉬워집니다.
