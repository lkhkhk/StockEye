## 텔레그램 봇 `/symbols` 명령어 문제 해결 계획 (2025-08-01)

### 1. 현재 상황 요약

*   **문제:** 텔레그램 봇의 `/symbols` 명령어가 여전히 정상 작동하지 않습니다. "종목 목록 조회 실패: 알 수 없는 오류가 발생했습니다." 메시지가 계속 표시됩니다.
*   **원인 분석 (이전까지):**
    *   `api_service`의 `/symbols/` 엔드포인트가 모든 종목 데이터를 반환하여 텔레그램 메시지 길이 제한(4096자)을 초과하는 것이 문제의 원인으로 파악되었습니다.
    *   `src/api/routers/stock_master.py` 파일의 `get_all_symbols` 함수에 `limit` 파라미터를 추가하여 반환되는 종목 수를 제한하도록 수정했습니다.
    *   `src/bot/handlers/symbols.py` 파일의 `symbols_command` 함수에서 API 호출 시 `limit=10` 파라미터를 포함하도록 수정했습니다.
    *   `api` 및 `bot` 서비스를 강제로 재빌드하고 재시작하여 변경 사항을 적용했습니다.
*   **최신 테스트 결과:**
    *   `bot` 컨테이너 내부에서 `requests`를 사용하여 `http://api_service:8000/symbols/?limit=10` 엔드포인트를 직접 호출한 결과, **여전히 모든 종목 데이터가 반환되는 것을 확인했습니다.** (10개로 제한되지 않음)
    *   이는 `src/api/routers/stock_master.py`의 `limit` 로직이 예상대로 작동하지 않거나, Docker 빌드/배포 과정에서 알 수 없는 문제가 발생했을 가능성을 시사합니다.

### 2. 내일 작업 계획

1.  **API 로직 심층 디버깅 (`src/api/routers/stock_master.py`):**
    *   `get_all_symbols` 함수 내부에 디버그 로그를 추가하여 `limit` 파라미터가 함수 내부로 정확히 전달되는지, 그리고 SQLAlchemy 쿼리(`db.query(StockMaster).limit(limit).all()`)가 `limit`을 제대로 적용하여 SQL 쿼리를 생성하는지 상세히 확인하겠습니다.
    *   필요하다면 `limit` 값을 코드에 직접 하드코딩하여 (`.limit(10)`) `Query` 파라미터 주입 문제인지, 아니면 SQLAlchemy 쿼리 자체의 문제인지 파악하겠습니다.
2.  **API 서비스 강제 재빌드 및 재시작:** API 코드 수정 후에는 `api` 서비스만 다시 한번 `docker compose build --no-cache api && docker compose up -d api` 명령으로 강제 재빌드 및 재시작하여 변경 사항이 확실히 반영되도록 하겠습니다.
3.  **API 응답 재테스트 (봇 컨테이너에서):** 재빌드 후 `bot` 컨테이너에서 `requests` 스크립트를 사용하여 `/symbols/?limit=10` 엔드포인트의 응답이 실제로 10개로 제한되는지 다시 한번 정확히 확인하겠습니다.
4.  **봇 로그 상세 분석 (API 수정 확인 후):** API가 정상적으로 제한된 응답을 반환하기 시작하면, `bot_service`의 최신 로그를 다시 면밀히 검토하여 텔레그램 메시지 길이 제한 문제가 해결되었는지, 또는 다른 새로운 오류가 발생하는지 확인하겠습니다.
5.  **최종 커밋:** `/symbols` 명령어가 텔레그램 봇에서 완전히 정상 작동하는 것을 확인한 후에 모든 관련 변경 사항을 커밋하겠습니다.
