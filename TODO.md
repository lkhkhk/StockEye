# StockEye ê°œë°œ ê³„íš ë° í˜„í™©

## ğŸš¨ ìµœìš°ì„  ê³¼ì œ: ì•„í‚¤í…ì²˜ ì¬ì„¤ê³„ ë° ì•ˆì •í™”

> **í˜„í™©:** E2E í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ `api`ì™€ `bot` ì„œë¹„ìŠ¤ ê°„ì˜ ìˆœí™˜ ì˜ì¡´ì„±ìœ¼ë¡œ ì¸í•œ ì‹¬ê°í•œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë° ê¸°ëŠ¥ ë¯¸ì‘ë™ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Message Queue(Redis)ë¥¼ ë„ì…í•˜ê³ , ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë³„ë„ì˜ `worker` ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒìœ¼ë¡œ ì•„í‚¤í…ì²˜ë¥¼ ì¬ì„¤ê³„í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

> **ëª©í‘œ:** ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë„ì…í•˜ì—¬ ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³ , ì‹œìŠ¤í…œ ì „ì²´ì˜ ì•ˆì •ì„±ê³¼ í™•ì¥ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ê¸°ì¡´ì˜ í•µì‹¬ ê¸°ëŠ¥ ë¯¸ì‘ë™ ë²„ê·¸ë“¤ì„ ëª¨ë‘ í•´ê²°í•˜ê³ , ì•ˆì •ì ì¸ E2E í…ŒìŠ¤íŠ¸ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.

---

### Phase 1: ì•„í‚¤í…ì²˜ ì¬ì„¤ê³„ ë° ì¸í”„ë¼ êµ¬ì¶•

-   [x] **[ì¸í”„ë¼] `docker-compose.yml` ìˆ˜ì •:**
    -   [x] `redis` ì„œë¹„ìŠ¤ë¥¼ ì‹ ê·œ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
    -   [x] `worker` ì„œë¹„ìŠ¤ë¥¼ ì‹ ê·œ ì¶”ê°€í•˜ê³  `Dockerfile`ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
    -   [x] ëª¨ë“  ì„œë¹„ìŠ¤(`api`, `bot`, `db`, `redis`, `worker`)ì˜ ì´ë¦„ê³¼ `container_name`ì— `stockeye-` ì ‘ë‘ì‚¬ë¥¼ ë¶™ì—¬ ëª…ëª… ê·œì¹™ì„ í†µì¼í–ˆìŠµë‹ˆë‹¤.
    -   [x] ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì— ì‚¬ìš©ë˜ëŠ” í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ëª…ìœ¼ë¡œ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.
-   [x] **[ë¦¬íŒ©í† ë§] ì„œë¹„ìŠ¤ëª… ë³€ê²½ì— ë”°ë¥¸ í”„ë¡œì íŠ¸ ì „ì²´ ìˆ˜ì •:**
    -   [x] `docker-compose.yml`ì˜ ì„œë¹„ìŠ¤ëª… ë³€ê²½ì‚¬í•­ì„ `bot` í•¸ë“¤ëŸ¬, í…ŒìŠ¤íŠ¸ ì½”ë“œ, ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ë“± í”„ë¡œì íŠ¸ ë‚´ì˜ ëª¨ë“  ê´€ë ¨ íŒŒì¼ì— ì¼ê´„ ì ìš©í–ˆìŠµë‹ˆë‹¤.
-   [x] **[ì‹ ê·œ] `worker` ì„œë¹„ìŠ¤ ê¸°ë³¸ êµ¬í˜„:**
    -   [x] `src/worker/main.py`ë¥¼ ìƒì„±í•˜ê³ , Redis Pub/Sub êµ¬ë… ë° ê¸°ë³¸ ë¡œê¹… ë¡œì§ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
    -   [x] `docker compose up --build`ë¥¼ í†µí•´ ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ê¸°ë™ë¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

### Phase 2: Worker ì„œë¹„ìŠ¤ ê¸°ëŠ¥ ì´ì „ ë° í…ŒìŠ¤íŠ¸

-   [x] **[ì™„ë£Œ] ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ëŠ¥ ì´ì „ ë° í…ŒìŠ¤íŠ¸:**
    -   **ëª©í‘œ:** `api` ì„œë¹„ìŠ¤ì˜ APScheduler ê´€ë ¨ ì½”ë“œë¥¼ `worker` ì„œë¹„ìŠ¤ë¡œ ì´ì „í•˜ê³ , ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì•ˆì •ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.
    -   **ì‘ì—… ë‹¨ê³„:**
        1.  `api/main.py`ì˜ ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë ¨ ì½”ë“œë¥¼ `worker/main.py`ë¡œ ì´ì „í•©ë‹ˆë‹¤.
        2.  `worker`ê°€ DB ë° ì„œë¹„ìŠ¤(StockService, PriceAlertService)ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì˜ì¡´ì„±ì„ ì„¤ì •í•©ë‹ˆë‹¤.
        3.  `api/main.py`ì—ì„œ ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë ¨ ì½”ë“œë¥¼ ì™„ì „íˆ ì œê±°í•©ë‹ˆë‹¤.
        4.  `src/worker/tests/unit/test_scheduler.py`ë¥¼ ì‘ì„±í•˜ì—¬ ê° ìŠ¤ì¼€ì¤„ë§ ì¡(`update_stock_master_job` ë“±)ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. (ì„œë¹„ìŠ¤ ë¡œì§ Mocking)
        5.  ëª¨ë“  ì„œë¹„ìŠ¤ ì¬ê¸°ë™ í›„, `worker` ë¡œê·¸ë¥¼ í†µí•´ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì •ìƒì ìœ¼ë¡œ ì¡ì„ ë“±ë¡í•˜ê³  ì‹¤í–‰í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

-   [x] **[ì™„ë£Œ] ì•Œë¦¼ ê¸°ëŠ¥ ë¦¬íŒ©í† ë§ ë° í…ŒìŠ¤íŠ¸:**
    -   **ëª©í‘œ:** ê¸°ì¡´ì˜ ë™ê¸°ì  ì•Œë¦¼ ë¡œì§ì„ Redis Pub/Sub ê¸°ë°˜ì˜ ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•˜ê³ , ì´ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
    -   **ì‘ì—… ë‹¨ê³„:**
        1.  **`api` ì„œë¹„ìŠ¤:** `price_alert_service.py` ë“±ì—ì„œ `bot`ì„ ì§ì ‘ í˜¸ì¶œí•˜ë˜ ë¡œì§ì„ ì œê±°í•˜ê³ , `chat_id`ì™€ ë©”ì‹œì§€ ë‚´ìš©ì„ Redisì˜ `notifications` ì±„ë„ì— ë°œí–‰(Publish)í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤. (í™•ì¸ ê²°ê³¼, ì´ ë¡œì§ì€ `worker` ì„œë¹„ìŠ¤ì— ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆì—ˆìŒ)
        2.  **`worker` ì„œë¹„ìŠ¤:** `notification_listener`ê°€ ìˆ˜ì‹ í•œ ë©”ì‹œì§€ë¥¼ ë°”íƒ•ìœ¼ë¡œ `telegram-bot` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ë„ë¡ êµ¬í˜„í•©ë‹ˆë‹¤.
        3.  [x] **`src/worker/tests/unit/test_listener.py`ë¥¼ ì‘ì„±í•˜ì—¬ `notification_listener`ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.** (Redis ë©”ì‹œì§€ ìˆ˜ì‹  ë° `send_telegram_message` í˜¸ì¶œ ê²€ì¦)
        4.  **`src/api/tests/integration/test_notification_publish.py`ë¥¼ ì‘ì„±í•˜ì—¬ `api`ê°€ Redisì— ë©”ì‹œì§€ë¥¼ ì˜¬ë°”ë¥´ê²Œ ë°œí–‰í•˜ëŠ”ì§€ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.**
            -   **í˜„í™©:** ìˆ˜ë§ì€ í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¬¸ì œ(DB ì†ìƒ, Fixture ì„¤ê³„ ì˜¤ë¥˜, ë¼ìš°í„° ì„¤ì • ì˜¤ë¥˜ ë“±)ë¥¼ í•´ê²°í•˜ê³ , ìµœì¢…ì ìœ¼ë¡œ `async/await` ëˆ„ë½ ë²„ê·¸ë¥¼ ìˆ˜ì •í•˜ì—¬ **ì•Œë¦¼ ìƒì„± ê¸°ëŠ¥ì— ëŒ€í•œ í†µí•© í…ŒìŠ¤íŠ¸(`test_create_price_alert_successfully`)ê°€ í†µê³¼ë¨ì„ í™•ì¸**í–ˆìŠµë‹ˆë‹¤.
            -   **ë‹¤ìŒ ë‹¨ê³„:** ì•Œë¦¼ 'ìƒì„±'ì´ ì•„ë‹Œ, `worker`ì˜ ìŠ¤ì¼€ì¤„ëŸ¬ì— ì˜í•´ ì•Œë¦¼ ì¡°ê±´ì´ ë§ëŠ”ë‹¤ê³  íŒë‹¨ë˜ì—ˆì„ ë•Œ Redisì— ë©”ì‹œì§€ë¥¼ **'ë°œí–‰'**í•˜ëŠ” ë¡œì§(`price_alert_service.check_price_alerts`)ì— ëŒ€í•œ ë³„ë„ì˜ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
        5.  [x] **`price_alert_service.check_price_alerts`ì— ëŒ€í•œ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.**
            -   **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¤ê³„:**
                -   **Given (ì¤€ë¹„):**
                    -   í…ŒìŠ¤íŠ¸ìš© ì‚¬ìš©ì, ì£¼ì‹(ì˜ˆ: ì‚¼ì„±ì „ì), ê°€ê²© ì •ë³´(ì˜ˆ: 75,000ì›)ë¥¼ DBì— ìƒì„±í•©ë‹ˆë‹¤.
                    -   í•´ë‹¹ ì‚¬ìš©ìì™€ ì£¼ì‹ì— ëŒ€í•œ ì•Œë¦¼(ì˜ˆ: 80,000ì› ì´ìƒì¼ ë•Œ ì•Œë¦¼)ì„ ìƒì„±í•©ë‹ˆë‹¤.
                    -   Redis í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¤€ë¹„í•˜ê³  `notifications` ì±„ë„ì„ êµ¬ë…í•©ë‹ˆë‹¤.
                -   **When (ì‹¤í–‰):**
                    -   ì•Œë¦¼ ì¡°ê±´ì„ ì¶©ì¡±ì‹œí‚¤ëŠ” ìƒˆë¡œìš´ ê°€ê²© ì •ë³´(ì˜ˆ: 81,000ì›)ë¥¼ DBì— ì¶”ê°€í•©ë‹ˆë‹¤.
                    -   `PriceAlertService`ì˜ `check_price_alerts` ë©”ì„œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.
                -   **Then (ê²€ì¦):**
                    -   Redis `notifications` ì±„ë„ì— ë©”ì‹œì§€ê°€ ë°œí–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                    -   ë°œí–‰ëœ ë©”ì‹œì§€ì˜ `chat_id`ì™€ ë‚´ìš©ì´ ì˜ˆìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
                    -   ì•Œë¦¼ì´ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ëœ í›„, DBì—ì„œ í•´ë‹¹ ì•Œë¦¼ì˜ ìƒíƒœ(`is_active` ë“±)ê°€ ì˜¬ë°”ë¥´ê²Œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
            -   **êµ¬í˜„ ìœ„ì¹˜:** `src/api/tests/unit/test_price_alert_service.py`

### Phase 3: í•µì‹¬ ê¸°ëŠ¥ ì •ìƒí™” ë° E2E í…ŒìŠ¤íŠ¸ êµ¬ì¶•

> **ëª©í‘œ:** ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ ìœ„ì—ì„œ ê¸°ì¡´ì˜ ëª¨ë“  ë²„ê·¸ë¥¼ í•´ê²°í•˜ê³ , ê° ê¸°ëŠ¥ì— ëŒ€í•œ E2E í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì•ˆì •ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.

-   [x] **[ì™„ë£Œ] ì‚¬ìš©ì ë°ì´í„° ì—°ë™ ê¸°ëŠ¥ ì •ìƒí™”:**
    -   **ëŒ€ìƒ:** `alert`, `history`, `trade`, `watchlist` ë“±
    -   **í•´ê²° ë°©ì•ˆ:** `telegram_id` ê¸°ë°˜ì˜ ì‚¬ìš©ì ì‹ë³„ ë¡œì§ì„ `api` ì„œë¹„ìŠ¤ì— ì¤‘ì•™í™”í•˜ì—¬ êµ¬í˜„í–ˆë˜ ë‚´ìš©ì„ ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ì— ë§ê²Œ ì¬ê²€ì¦í•˜ê³  ì•ˆì •í™”í•©ë‹ˆë‹¤.
    -   **ê²€ì¦:** ê° ê¸°ëŠ¥ì— ëŒ€í•œ **Bot-API-Worker ì—°ë™ E2E í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë°˜ë“œì‹œ ì‘ì„±**í•˜ì—¬ ë²„ê·¸ ì¬ë°œì„ ë°©ì§€í•©ë‹ˆë‹¤.

-   [x] **[ì™„ë£Œ] `natural` í•¸ë“¤ëŸ¬ API ì‘ë‹µ í˜•ì‹ ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°:**
    -   **í•´ê²°:** `natural.py`ì—ì„œ API ì‘ë‹µ(`{"items": [...]}`)ì„ ì˜¬ë°”ë¥´ê²Œ íŒŒì‹±í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
    -   **ê²€ì¦:** E2E í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ìì—°ì–´ ì²˜ë¦¬ ê¸°ëŠ¥ì˜ ì •ìƒ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.

-   [x] **[ì™„ë£Œ] ì˜ˆì¸¡ ì´ë ¥ ì €ì¥ì„ ìœ„í•œ `user_id` ì „ë‹¬:**
    -   **í˜„í™©:** `predict`, `natural` í•¸ë“¤ëŸ¬ì—ì„œ `/predict` API í˜¸ì¶œ ì‹œ `telegram_id`ë¥¼ í¬í•¨í•˜ê³ , `api`ëŠ” ì´ë¥¼ `user_id`ë¡œ ë³€í™˜í•˜ì—¬ ì´ë ¥ì„ ì €ì¥í•˜ë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„ ì¤‘.
    -   **ë°œìƒ ë¬¸ì œ:**
        *   **API ë¼ìš°í„° ê²½ë¡œ ë¶ˆì¼ì¹˜:** `bot`ì—ì„œ `/predict`ë¡œ í˜¸ì¶œí–ˆìœ¼ë‚˜ `api` ë¼ìš°í„°ê°€ `/predict/`ë¡œ ì„¤ì •ë˜ì–´ `307 Temporary Redirect` ë°œìƒ ë° POST ë³¸ë¬¸ ìœ ì‹¤. (`/predict`ë¡œ ìˆ˜ì • ì™„ë£Œ)
        *   **í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‹œë”© ë¶ˆì¼ì¹˜:** `api` ì„œë¹„ìŠ¤ ì‹œì‘ ì‹œ `StockMaster` í…Œì´ë¸”ì— ì´ë¯¸ ì¡´ì¬í•œë‹¤ê³  íŒë‹¨í•˜ì—¬ ì‹œë”©ì„ ê±´ë„ˆë›°ì—ˆìœ¼ë‚˜, ì‹¤ì œ ê²€ìƒ‰ ì‹œ ë°ì´í„°ê°€ ì¡°íšŒë˜ì§€ ì•ŠëŠ” ë¬¸ì œ ë°œìƒ. (ì‹œë”© ë¡œì§ ë³´ê°• ì™„ë£Œ)
        *   **`predict_service` ë¡œì§ ì˜¤ë¥˜:** `predict_stock_movement` í•¨ìˆ˜ê°€ `calculate_analysis_items`ì˜ ê²°ê³¼ë¥¼ `None`ìœ¼ë¡œ ì˜ëª» íŒë‹¨í•˜ì—¬ "ì˜ˆì¸¡ ë¶ˆê°€"ë¥¼ ë°˜í™˜í•˜ëŠ” ë¬¸ì œ ë°œìƒ. (`predict_service` ë¡œì§ ìˆ˜ì • ì™„ë£Œ)
        *   **E2E í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì§€ì†:** ìœ„ ëª¨ë“  ìˆ˜ì •ì—ë„ ë¶ˆêµ¬í•˜ê³  E2E í…ŒìŠ¤íŠ¸ê°€ ë™ì¼í•œ ì˜¤ë¥˜ë¡œ ê³„ì† ì‹¤íŒ¨í•˜ê³  ìˆìŒ. ì´ëŠ” DB í™˜ê²½, Docker ë„¤íŠ¸ì›Œí¬, ë˜ëŠ” `pytest`ì™€ `asyncio`ì˜ ìƒí˜¸ì‘ìš© ë“± ë” ê·¼ë³¸ì ì¸ í™˜ê²½ì  ë¬¸ì œì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ.
    -   **í•´ê²°:** `httpx.Response.ok` ì†ì„± Deprecated ë¬¸ì œë¡œ í™•ì¸ë˜ì–´, `response.is_success` ë˜ëŠ” `response.status_code < 400`ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ í•´ê²°í–ˆìŠµë‹ˆë‹¤.
    -   **ê²€ì¦:** `src/bot/tests/e2e/test_prediction_history_e2e.py` í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸.
    -   **í˜„í™©:** ê³µì‹œ ë°ì´í„° ì €ì¥ ë° ì•Œë¦¼ ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸.

-   [x] **[ì™„ë£Œ] ë´‡ ê´€ë¦¬ì ëª…ë ¹ì–´(`show_schedules`) ì˜¤ë¥˜ í•´ê²°:**
    -   **ë¬¸ì œ:** `show_schedules` ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ `404 Not Found` ì˜¤ë¥˜ ë°œìƒ.
    -   **ì›ì¸:** ì•„í‚¤í…ì²˜ ë³€ê²½ (`api` -> `worker`ë¡œ ìŠ¤ì¼€ì¤„ëŸ¬ ì´ì „) í›„, `bot`ì´ `worker`ì™€ í†µì‹ í•˜ëŠ” ë°©ë²•ì´ êµ¬í˜„ë˜ì§€ ì•ŠìŒ.
    -   **í•´ê²° ê³„íš:**
        1.  `worker` ì„œë¹„ìŠ¤ì— FastAPIë¥¼ ë„ì…í•˜ì—¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì œì–´ìš© APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
        2.  `api` ì„œë¹„ìŠ¤ì— `worker` APIë¥¼ í˜¸ì¶œí•˜ëŠ” í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        3.  `bot` í•¸ë“¤ëŸ¬ê°€ `api` ì„œë¹„ìŠ¤ì˜ í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
    -   **ê²€ì¦:** `src/bot/tests/e2e/test_prediction_history_e2e.py` í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸.

-   [x] **[ì™„ë£Œ] ë´‡ ê´€ë¦¬ì ëª…ë ¹ì–´(`show_schedules`) ì˜¤ë¥˜ í•´ê²°:**
    -   **ë¬¸ì œ:** `show_schedules` ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ `404 Not Found` ì˜¤ë¥˜ ë°œìƒ.
    -   **ì›ì¸:** ì•„í‚¤í…ì²˜ ë³€ê²½ (`api` -> `worker`ë¡œ ìŠ¤ì¼€ì¤„ëŸ¬ ì´ì „) í›„, `bot`ì´ `worker`ì™€ í†µì‹ í•˜ëŠ” ë°©ë²•ì´ êµ¬í˜„ë˜ì§€ ì•ŠìŒ.
    -   **í•´ê²° ê³„íš:**
        1.  `worker` ì„œë¹„ìŠ¤ì— FastAPIë¥¼ ë„ì…í•˜ì—¬ ìŠ¤ì¼€ì¤„ëŸ¬ ì œì–´ìš© APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
        2.  `api` ì„œë¹„ìŠ¤ì— `worker` APIë¥¼ í˜¸ì¶œí•˜ëŠ” í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        3.  `bot` í•¸ë“¤ëŸ¬ê°€ `api` ì„œë¹„ìŠ¤ì˜ í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

## ğŸŒŸ Phase 4: í…ŒìŠ¤íŠ¸ ê³ ë„í™” ë° ì§€ì¹¨ ê°œì„  (ìœ ì§€)

-   [ ] **(ê¸°ì¡´) ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 100% ë‹¬ì„±**
    -   [x] **Bot í•¸ë“¤ëŸ¬:** `start.py` ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹ ê·œ ì‘ì„± ì™„ë£Œ.
    -   [x] **Bot í•¸ë“¤ëŸ¬:** `history.py` ë“± ëˆ„ë½ëœ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
    -   [ ] **API ë¼ìš°í„°:** `admin.py` ë“± ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ì—†ëŠ” ëª¨ë“  ë¼ìš°í„°ì— ëŒ€í•´ ì‹ ê·œ ì‘ì„±í•©ë‹ˆë‹¤.
    -   [ ] **API ì„œë¹„ìŠ¤:** `stock_service.py` ë“± ê¸°ì¡´ í…ŒìŠ¤íŠ¸ë¥¼ ë³´ê°•í•˜ê³  ìˆœìˆ˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ ë¦¬íŒ©í† ë§í•©ë‹ˆë‹¤.
    -   [ ] **`common` ëª¨ë“ˆ:** ëª¨ë“  ê³µí†µ ëª¨ë“ˆì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
        -   [ ] `src/common/models/` íŒŒì¼ë“¤ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
        -   [ ] `src/common/schemas/` íŒŒì¼ë“¤ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
        -   [ ] `src/common/services/price_alert_service.py`ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
        -   [ ] `src/common/services/stock_service.py`ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
-   [ ] **(ê¸°ì¡´) í†µí•© í…ŒìŠ¤íŠ¸ ë³´ê°•**
    -   [ ] `predict.py` ë“± í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì—†ëŠ” API ë¼ìš°í„°ì— ëŒ€í•´ ì‹ ê·œ ì‘ì„±í•©ë‹ˆë‹¤.

## âš™ï¸ Phase 5: í™˜ê²½ ë³€ìˆ˜ ë° DB ì„¤ì • ì•ˆì •í™”

-   [x] **`TELEGRAM_BOT_TOKEN` í™˜ê²½ ë³€ìˆ˜ ë¬¸ì œ í•´ê²°:**
    -   `worker` ì„œë¹„ìŠ¤ ë¡œê·¸ì— `The "TELEGRAM_BOT_TOKEN" variable is not set.` ê²½ê³ ê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œ í•´ê²°.
    -   `docker-compose.yml` ë° ê´€ë ¨ íŒŒì¼ ê²€í† í•˜ì—¬ `TELEGRAM_BOT_TOKEN`ì´ ëª¨ë“  ì„œë¹„ìŠ¤ì— ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸.
-   [x] **`.env` íŒŒì¼ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì „ë°˜ ê²€í† :**
    -   `docker-compose.yml`, `Dockerfile`ë“¤, `settings.env.example` ë“±ì„ ê²€í† í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì˜ ì¼ê´€ì„± í™•ë³´.
    -   `db` ì„œë¹„ìŠ¤ ë•Œë¬¸ì— í•„ìš”í•˜ë‹¤ê³  ì•Œë ¤ì§„ `.env` íŒŒì¼ì˜ í•„ìš”ì„±ì„ ì¬ê²€í† í•˜ê³ , ê°€ëŠ¥í•˜ë‹¤ë©´ ì˜ì¡´ì„± ì œê±° ë°©ì•ˆ ëª¨ìƒ‰.

## âš™ï¸ Phase 6: ì „ì—­ HTTP í´ë¼ì´ì–¸íŠ¸(session) ì œê±° ë¦¬íŒ©í† ë§

> **ëª©í‘œ:** í”„ë¡œì íŠ¸ ì „ë°˜ì— ê±¸ì³ ì‚¬ìš©ë˜ëŠ” `src/common/http_client.py`ì˜ ì „ì—­ `session` ê°ì²´ë¥¼ ì œê±°í•˜ì—¬, ëª¨ë“ˆ ë¡œë”© ì‹œì ì˜ ì˜ì¡´ì„±ì„ ì—†ì• ê³  í…ŒìŠ¤íŠ¸ ìš©ì´ì„±ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤. ëª¨ë“  HTTP ìš”ì²­ì€ `get_retry_client()` íŒ©í† ë¦¬ í•¨ìˆ˜ë¥¼ í†µí•´ ìƒì„±ëœ í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•©ë‹ˆë‹¤.

-   [x] **`src/bot/handlers/predict.py`**
-   [x] **`src/bot/handlers/register.py`**
-   [x] `src/common/dart_utils.py`
-   [x] `src/bot/handlers/history.py`
-   [x] `src/bot/handlers/alert.py`
-   [x] `src/bot/handlers/symbols.py`
-   [x] `src/bot/handlers/trade.py`
-   [x] `src/bot/handlers/watchlist.py`
-   [x] `src/bot/handlers/admin.py`
-   [x] ê´€ë ¨ í…ŒìŠ¤íŠ¸ íŒŒì¼ ëª¨ë‘ ìˆ˜ì • (`test_dart_utils.py`, `test_bot_admin.py` ë“±)

## âœ¨ Phase 7: í–¥í›„ ê°œì„  ê³¼ì œ

-   [ ] **API ì¸ì¦ ë¬¸ì œ (curl) ì¶”ê°€ ë””ë²„ê¹…:** (ìš°ì„ ìˆœìœ„ ë‚®ìŒ, ë´‡ì„ í†µí•œ ê¸°ëŠ¥ì€ ì •ìƒ ì‘ë™í•˜ë¯€ë¡œ)
-   [ ] **ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œ `test_page_limit` í™œìš©:**
-   [ ] **DART API ìµœì í™” (last_rcept_no) ì¶”ê°€ ê²€ì¦:**
-   [ ] **[ì‹ ê·œ] ì•Œë¦¼ ì‹œìŠ¤í…œ ê³ ë„í™”:**
    -   **ëª©í‘œ:** í˜„ì¬ í…”ë ˆê·¸ë¨ì— ì¢…ì†ëœ ì•Œë¦¼ ì‹œìŠ¤í…œì„ ë‹¤ì¤‘ ì±„ë„(ì´ë©”ì¼, SMS, ë””ìŠ¤ì½”ë“œ ë“±)ì„ ì§€ì›í•˜ëŠ” ìœ ì—°í•œ êµ¬ì¡°ë¡œ ë¦¬íŒ©í† ë§í•©ë‹ˆë‹¤.
    -   **êµ¬í˜„ ë°©í–¥:**
        1.  APIê°€ Redisì— ë°œí–‰í•˜ëŠ” ë©”ì‹œì§€ë¥¼ `{"user_id": ..., "message": ...}`ì™€ ê°™ì´ ì¼ë°˜í™”í•©ë‹ˆë‹¤.
        2.  WorkerëŠ” ì´ ë©”ì‹œì§€ë¥¼ ë°›ì•„, DBì—ì„œ ì‚¬ìš©ìì˜ ì•Œë¦¼ ì„¤ì •ì„ ì¡°íšŒí•œ í›„, ì„¤ì •ëœ ëª¨ë“  ì±„ë„ë¡œ ì•Œë¦¼ì„ ë°œì†¡í•˜ëŠ” "ì•Œë¦¼ ë¼ìš°í„°" ì—­í• ì„ ìˆ˜í–‰í•˜ë„ë¡ ë³€ê²½í•©ë‹ˆë‹¤.
        3.  ì‚¬ìš©ìê°€ ìì‹ ì˜ ì•Œë¦¼ ì±„ë„ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ” APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
    -   **ê´€ë ¨ ë¬¸ì„œ:** `docs/archive/notification_system_architecture.md`

### Phase 7: ì•„í‚¤í…ì²˜ ê°œì„  - ì„œë¹„ìŠ¤ ê²°í•©ë„ ì™„í™” (ì§„í–‰ ì¤‘)

*   **ëª©í‘œ:** `worker` ì„œë¹„ìŠ¤ê°€ `api` ì„œë¹„ìŠ¤ì˜ ì†ŒìŠ¤ ì½”ë“œ(`src/api/services`, `src/api/models`)ì— ì§ì ‘ ì˜ì¡´í•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ì—¬ ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  ë…ë¦½ì„±ì„ ê°•í™”í•©ë‹ˆë‹¤.
*   **ì„¸ë¶€ ì§„í–‰ ê³„íš:**
    *   [x] **1ë‹¨ê³„ (íŒŒì¼ ì´ë™):** `price_alert_service.py`, `stock_service.py` ë° `src/api/models`ì˜ ëª¨ë“  ëª¨ë¸ íŒŒì¼ì„ `src/common`ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
    *   [x] **2ë‹¨ê³„ (ì½”ë“œ ìˆ˜ì •):** `worker` ë° `api` ì„œë¹„ìŠ¤ì˜ ëª¨ë“  ê´€ë ¨ `import` êµ¬ë¬¸ì„ `src/common` ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
    *   [x] **3ë‹¨ê³„ (ì„¤ì • ìˆ˜ì •):** `docker-compose.yml`ì—ì„œ `stockeye-worker` ì„œë¹„ìŠ¤ì˜ ë¶ˆí•„ìš”í•œ ë³¼ë¥¨ ë§ˆìš´íŠ¸(`src/api/services`, `src/api/models`)ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
    *   [ ] **4.ë‹¨ê³„ (ê²€ì¦):** `api`, `bot`, `worker`ì˜ ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³ , ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì¬ê¸°ë™í•˜ì—¬ ë¦¬íŒ©í† ë§ ê²°ê³¼ë¥¼ ìµœì¢… ê²€ì¦í•©ë‹ˆë‹¤.
    -   [ ] `api` ì„œë¹„ìŠ¤ê°€ `bot` ì„œë¹„ìŠ¤ë¡œë¶€í„° í•„ìš”ë¡œ í•˜ëŠ” ë¡œì§ ë“±ì„ ì‹ë³„í•©ë‹ˆë‹¤. ìƒê¸°ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê³µìœ  ëª¨ë“ˆì„ ì‹ë³„í•˜ì—¬ ë¶„ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ ì´ì „ì— í•´ê²°ëœ ì£¼ìš” ë¬¸ì œì 

-   [x] **[API] í†µí•© í…ŒìŠ¤íŠ¸ 404 ì˜¤ë¥˜ í•´ê²°:** `src/api/main.py`ì˜ ë¼ìš°í„° `prefix` ì„¤ì •ê³¼ `TestClient` í˜¸ì¶œ ê²½ë¡œì˜ ì¼ê´€ì„± í™•ì¸ ë° ìˆ˜ì •.
-   [x] **[Bot/API] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ Mocking/Import ì˜¤ë¥˜ í•´ê²°:**
    -   [x] `src/bot/tests/unit/test_alert_handler.py`, `test_bot_natural.py`, `test_bot_predict.py`, `test_bot_register.py` ë“±ì—ì„œ Mocking ê´€ë ¨ ì˜¤ë¥˜ (`TypeError: object AsyncMock can't be used in 'await' expression` ë“±)ê°€ ë°œìƒí•©ë‹ˆë‹¤.
    -   [x] `src/bot/tests/unit/test_bot_natural.py`ì—ì„œ `ModuleNotFoundError: No module named 'src.bot.handlers.natural.session'` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
    -   [x] `src/api/tests/unit/test_auth_service.py`ì—ì„œ `ModuleNotFoundError: No module named 'src.api.services.auth_service.pwd_context'` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
-   [x] **[API] ì„œë¹„ìŠ¤ ë¡œì§ ì˜¤ë¥˜ í•´ê²°:** `src/api/tests/unit/test_predict_service.py`, `test_price_alert_service.py`, `test_stock_service.py` ë“±ì—ì„œ `KeyError` ë˜ëŠ” `TypeError`ì™€ ê°™ì€ ë¡œì§ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
-   [x] **[Worker] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜ í•´ê²°:**
    -   [x] `src/worker/tests/unit/test_listener.py`ì—ì„œ `TypeError: object AsyncMock can't be used in 'await' expression` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
    -   [x] `src/worker/tests/unit/test_main_jobs.py`ì—ì„œ `ModuleNotFoundError: No module named 'src.api.main'` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
---

## ğŸ 2025-08-12: `trigger_job` ëª…ë ¹ì–´ ë²„ê·¸ ìˆ˜ì •

-   **[ì™„ë£Œ] ë´‡ ê´€ë¦¬ì ëª…ë ¹ì–´(`trigger_job`) ì˜¤ë¥˜ í•´ê²° ë° ê¸°ëŠ¥ ê°œì„ :**
    -   **ë¬¸ì œ:** `trigger_job [job_id]` ë´‡ ëª…ë ¹ì–´ê°€ "ì¡ ì‹¤í–‰ ì™„ë£Œ" ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì¡ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    -   **ì›ì¸ ë¶„ì„:**
        1.  `src/worker/routers/scheduler.py`ì˜ `trigger_scheduler_job` í•¨ìˆ˜ê°€ ê¸°ì¡´ ì¡ì„ ì¦‰ì‹œ ì‹¤í–‰(`modify`)í•˜ëŠ” ëŒ€ì‹ , ì¼íšŒì„±ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ìƒˆë¡œìš´ ì¡ì„ ì¶”ê°€(`add_job`)í•˜ê³  ìˆì–´, ì˜ë„ëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    -   **í•´ê²° ê³„íš:**
        1.  **Worker ë¡œì§ ìˆ˜ì •:**
            -   `src/worker/routers/scheduler.py`ì˜ `trigger_scheduler_job` í•¨ìˆ˜ë¥¼ `job.modify(next_run_time=datetime.now(job.next_run_time.tzinfo))`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•˜ì—¬, ì¡ì´ ì¦‰ì‹œ ì‹¤í–‰ë˜ë„ë¡ ì˜¬ë°”ë¥´ê²Œ ë³€ê²½í•©ë‹ˆë‹¤.
            -   ì‹¤í–‰ ê²°ê³¼ë¥¼ ëª…í™•í•˜ê²Œ ë‚˜íƒ€ë‚´ëŠ” JSON ì‘ë‹µ(ì˜ˆ: `{"job_id": job.id, "message": "Job triggered successfully", "triggered_at": ...}`)ì„ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
        2.  **Bot í•¸ë“¤ëŸ¬ ìˆ˜ì •:**
            -   `src/bot/handlers/admin.py`ì˜ `admin_trigger_job` í•¨ìˆ˜ë¥¼ Workerì˜ ìƒˆë¡œìš´ JSON ì‘ë‹µ í˜•ì‹ì— ë§ê²Œ ë©”ì‹œì§€ í¬ë§·íŒ… ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì—¬, `job_id`ì™€ `triggered_at` ë“±ì˜ ì •ë³´ê°€ ì •í™•íˆ í‘œì‹œë˜ë„ë¡ í•©ë‹ˆë‹¤.
        3.  **ê²€ì¦:**
            -   `docker compose`ë¥¼ í†µí•´ ì „ì²´ ì„œë¹„ìŠ¤ë¥¼ ì¬ê¸°ë™í•˜ê³ , ì‹¤ì œ ë´‡ ëª…ë ¹ì–´ë¥¼ í†µí•´ E2E í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì—¬ ìµœì¢… ê²°ê³¼ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
            -   `worker` ì„œë¹„ìŠ¤ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ì¡ ì‹¤í–‰ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

## Phase 8: ë¦¬ì†ŒìŠ¤ ìµœì í™” ê³¼ì œ

### 8.1. `worker` ì„œë¹„ìŠ¤ 'ì¢…ëª©ë§ˆìŠ¤í„° ê°±ì‹ ' OOM ë¬¸ì œ í•´ê²° (ì™„ë£Œ)

*   **ë¬¸ì œ:** Oracle VM í™˜ê²½ì—ì„œ 'ì¢…ëª©ë§ˆìŠ¤í„° ê°±ì‹ ' ê´€ë¦¬ì ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ `worker` ì„œë¹„ìŠ¤ê°€ ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ ë‹¤ìš´ë˜ëŠ” ë¬¸ì œ ë°œìƒ. `src/common/dart_utils.py`ì˜ `dart_get_all_stocks` í•¨ìˆ˜ê°€ `CORPCODE.xml` íŒŒì¼ì„ ë©”ëª¨ë¦¬ì— í†µì§¸ë¡œ ë¡œë“œí•˜ì—¬ íŒŒì‹±í•˜ëŠ” ë¹„íš¨ìœ¨ì ì¸ ë°©ì‹ì´ ì›ì¸.
*   **í•´ê²°:** `src/common/dart_utils.py` íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ `dart_get_all_stocks` í•¨ìˆ˜ì—ì„œ XML íŒŒì‹± ë°©ì‹ì„ `lxml.etree.iterparse`ë¥¼ ì‚¬ìš©í•œ **ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹±**ìœ¼ë¡œ ë³€ê²½. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ íšê¸°ì ìœ¼ë¡œ ì¤„ì„.
*   **ê´€ë ¨ íŒŒì¼:** `src/common/dart_utils.py`
*   **ê²€ì¦:** Docker Compose í™˜ê²½ì—ì„œ ì„±ê³µì ìœ¼ë¡œ ê²€ì¦ ì™„ë£Œ.

### 8.2. `ì¼ë³„ ì‹œì„¸ ê°±ì‹ ` ì‘ì—… ë¦¬ì†ŒìŠ¤ ìµœì í™” (ì™„ë£Œ)

*   **ê³¼ì œ ID:** OPT-001
*   **ë¬¸ì œ:** `src/api/services/stock_service.py`ì˜ `update_daily_prices` í•¨ìˆ˜ëŠ” DBì˜ ëª¨ë“  ì¢…ëª©ì„ í•œ ë²ˆì— ê°€ì ¸ì™€ `yfinance`ë¥¼ í†µí•´ ì¼ë³„ ì‹œì„¸ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤. ì¢…ëª© ìˆ˜ê°€ ì¦ê°€í• ìˆ˜ë¡ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë° ì²˜ë¦¬ ì‹œê°„ì´ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€í•˜ì—¬ OOM ë°œìƒ ê°€ëŠ¥ì„±ì´ ë†’ì•˜ìŠµë‹ˆë‹¤.
*   **í•´ê²° ë°©ì•ˆ:**
    1.  **ë°°ì¹˜ ì²˜ë¦¬ (Batch Processing):** `StockMaster`ë¥¼ í•œ ë²ˆì— ëª¨ë‘ ê°€ì ¸ì˜¤ì§€ ì•Šê³ , ì¼ì • ê°œìˆ˜(100ê°œ)ì”© ëŠì–´ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½.
    2.  **ë²Œí¬ ì‚½ì… (Bulk Insertion):** `db.add()` ëŒ€ì‹  `db.bulk_save_objects()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ë³„ ì‹œì„¸ ë°ì´í„°ë¥¼ í•œ ë²ˆì— DBì— ì‚½ì…í•˜ì—¬ ì„±ëŠ¥ ë° ë©”ëª¨ë¦¬ íš¨ìœ¨ ê°œì„ .
*   **ê´€ë ¨ íŒŒì¼:** `src/api/services/stock_service.py`
*   **ìƒíƒœ:** ê³¼ì œ ì™„ë£Œ ë° Docker Compose í™˜ê²½ì—ì„œ ì„±ê³µì ìœ¼ë¡œ ê²€ì¦ ì™„ë£Œ.

### 8.3. `ì „ì²´ ê³µì‹œ ê°±ì‹ ` ì‘ì—… ë¦¬ì†ŒìŠ¤ ìµœì í™” (ì™„ë£Œ)

*   **ê³¼ì œ ID:** OPT-002
*   **ë¬¸ì œ:** `src/api/services/stock_service.py`ì˜ `update_disclosures_for_all_stocks` í•¨ìˆ˜ê°€ DART APIì—ì„œ ëŒ€ëŸ‰ì˜ ê³µì‹œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , DBì— ì´ë¯¸ ì €ì¥ëœ **ëª¨ë“  ê³µì‹œ ì ‘ìˆ˜ë²ˆí˜¸**ë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ì—¬ ì¤‘ë³µì„ í™•ì¸í•©ë‹ˆë‹¤. ê³µì‹œ ë°ì´í„°ê°€ ë§ì•„ì§ˆ ê²½ìš° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ê¸‰ì¦í•˜ì—¬ OOM ë°œìƒ ê°€ëŠ¥ì„±ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
*   **í•´ê²° ë°©ì•ˆ:**
    1.  **DART API í˜¸ì¶œ ìµœì í™”:** `dart_utils.py`ì˜ `dart_get_disclosures` í•¨ìˆ˜ì— `last_rcept_no` íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ê³ , `stock_service.py`ì—ì„œ `SystemConfig`ì— ì €ì¥ëœ `last_checked_rcept_no`ë¥¼ ì´ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•˜ë„ë¡ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ DART APIì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ í™•ì¸ëœ ê³µì‹œ ì´í›„ì˜ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ë„ë¡ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.
    2.  **ê¸°ì¡´ ê³µì‹œ í™•ì¸ ìµœì í™”:** `check_and_notify_new_disclosures` í•¨ìˆ˜ ë‚´ì—ì„œ DARTì—ì„œ ê°€ì ¸ì˜¨ ê³µì‹œ ì¤‘ DBì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³µì‹œë¥¼ í•„í„°ë§í•˜ëŠ” ë¡œì§ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤.
*   **ê´€ë ¨ íŒŒì¼:** `src/api/services/stock_service.py`, `src/common/dart_utils.py`
*   **ìƒíƒœ:** ê³¼ì œ ì™„ë£Œ ë° Docker Compose í™˜ê²½ì—ì„œ ì„±ê³µì ìœ¼ë¡œ ê²€ì¦ ì™„ë£Œ.

### 8.4. `ê°€ê²© ì•Œë¦¼ í™•ì¸` ì‘ì—… ë‚´ ì¿¼ë¦¬ ìµœì í™” (ì§„í–‰ ì˜ˆì •)

*   **ê³¼ì œ ID:** OPT-003
*   **ë¬¸ì œ:** `src/api/services/price_alert_service.py`ì˜ `check_and_notify_price_alerts` í•¨ìˆ˜ ë‚´ì—ì„œ `db.query(DailyPrice).filter(DailyPrice.symbol.in_(symbols_to_check)).order_by(DailyPrice.date.desc()).all()` ì¿¼ë¦¬ê°€ ê° ì¢…ëª©ë³„ ìµœì‹  ê°€ê²©ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ê³ , `symbols_to_check`ì˜ í¬ê¸°ê°€ ì»¤ì§ˆ ê²½ìš° ì¿¼ë¦¬ ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*   **í•´ê²° ë°©ì•ˆ:** ê° ì¢…ëª©ë³„ ìµœì‹  ê°€ê²©ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ë„ë¡ ì¿¼ë¦¬ë¥¼ ìµœì í™” (ì˜ˆ: ì„œë¸Œì¿¼ë¦¬ ë˜ëŠ” `DISTINCT ON` ì‚¬ìš©).
*   **ê´€ë ¨ íŒŒì¼:** `src/api/services/price_alert_service.py`
*   **ìƒíƒœ:** ê³¼ì œ ë“±ë¡ ë° ì§„í–‰ ì˜ˆì •.

---

**[ì¤‘ìš”] ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ë° í–¥í›„ ê³„íš:**

Oracle VM í™˜ê²½ì—ì„œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ìœ„í•´ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ëŠ” ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë²ˆ ë¶„ì„ì„ í†µí•´ ì‹ë³„ëœ ëª¨ë“  ì ì¬ì  ë³‘ëª© ì§€ì ë“¤ì€ `TODO.md`ì— `OPT-XXX` ê³¼ì œë¡œ ëª…í™•íˆ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ ì´ ê³¼ì œë“¤ì„ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ìˆœì°¨ì ìœ¼ë¡œ ê°œì„  ì‘ì—…ì„ ì§„í–‰í•  ì˜ˆì •ì…ë‹ˆë‹¤. ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ ìµœì í™”ë¥¼ í†µí•´ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ ì„±ëŠ¥ì„ í™•ë³´í•´ ë‚˜ê°€ê² ìŠµë‹ˆë‹¤.

### Phase 9: Common ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ë° ê°œì„ 

-   [x] **[Test] `common` ëª¨ë“ˆ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë³´ê°•:**
    -   `dart_utils.py`ì˜ DART API ì—ëŸ¬ ì‘ë‹µ ë° í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ì—¬ ì½”ë“œ ì•ˆì •ì„±ì„ ë†’ì…ë‹ˆë‹¤.

### Phase 10: Common ëª¨ë“ˆ êµ¬ì¡° ë¦¬íŒ©í† ë§

-   [ ] **[Refactor] `common` ëª¨ë“ˆ ì†ŒìŠ¤ íŒŒì¼ ì¬ë¶„ë¥˜:**
    -   `utils`, `database` ë“± í•˜ìœ„ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³  ê´€ë ¨ ì†ŒìŠ¤ íŒŒì¼ì„ ì´ë™í•˜ì—¬ êµ¬ì¡°ë¥¼ ê°œì„ í•©ë‹ˆë‹¤.
    -   íŒŒì¼ ì´ë™ì— ë”°ë¥¸ í”„ë¡œì íŠ¸ ì „ì²´ì˜ `import` êµ¬ë¬¸ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.

### Phase 11: `common` ëª¨ë“ˆ ë¦¬íŒ©í† ë§ í›„ ì•ˆì •ì„± ê²€ì¦

-   [ ] **`common` ëª¨ë“ˆ ê²½ë¡œ ë³€ê²½ í›„ ì²´ê³„ì  í…ŒìŠ¤íŠ¸ ìˆ˜í–‰:**
    -   **ëª©í‘œ:** `common` ëª¨ë“ˆ ë¦¬íŒ©í† ë§ìœ¼ë¡œ ì¸í•œ ì ì¬ì  ì˜¤ë¥˜ë¥¼ íŒŒì•…í•˜ê³  í•´ê²°í•©ë‹ˆë‹¤.
    -   **í…ŒìŠ¤íŠ¸ ì ˆì°¨:**
        1.  **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸:** `api`, `bot`, `worker` ê° ì„œë¹„ìŠ¤ì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ê°œë³„ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ í•µì‹¬ ê¸°ëŠ¥ì˜ ì •ìƒ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.
            *   `docker compose exec stockeye-api pytest src/api/tests/unit`
            *   `docker compose exec stockeye-bot pytest src/bot/tests/unit`
            *   `docker compose exec stockeye-worker pytest src/worker/tests/unit`
        2.  **í†µí•© í…ŒìŠ¤íŠ¸:** ê° ì„œë¹„ìŠ¤ì˜ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„œë¹„ìŠ¤ ë‚´ë¶€ ë° ì™¸ë¶€(DB ë“±) ì—°ë™ ê¸°ëŠ¥ì˜ ì •ìƒ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.
            *   `docker compose exec stockeye-api pytest src/api/tests/integration`
            *   `docker compose exec stockeye-bot pytest src/bot/tests/integration`
        3.  **E2E í…ŒìŠ¤íŠ¸:** `bot` ì„œë¹„ìŠ¤ì˜ E2E í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì „ì²´ ì‹œìŠ¤í…œì˜ ì •ìƒ ë™ì‘ì„ í™•ì¸í•©ë‹ˆë‹¤.
            *   `docker compose exec stockeye-bot pytest src/bot/tests/e2e`
    -   **ì˜¤ë¥˜ ì²˜ë¦¬:**
        *   í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ, í•´ë‹¹ ì˜¤ë¥˜ê°€ `common` ëª¨ë“ˆ ë¦¬íŒ©í† ë§ê³¼ ì§ì ‘ì ì¸ ê´€ë ¨ì´ ìˆëŠ”ì§€ ë¶„ì„í•©ë‹ˆë‹¤.
        *   **ê´€ë ¨ëœ ì˜¤ë¥˜**ëŠ” ì¦‰ì‹œ ìˆ˜ì •í•©ë‹ˆë‹¤.
        *   **ê´€ë ¨ ì—†ëŠ” ê¸°ì¡´ ì˜¤ë¥˜**ëŠ” ë³„ë„ì˜ TODO í•­ëª©ìœ¼ë¡œ ë“±ë¡í•˜ê³ , í˜„ì¬ ì‘ì—… ë²”ìœ„ì—ì„œëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### Phase 12: í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡° ê°œì„ 

-   [ ] **`api/tests` í´ë” ë‚´ í…ŒìŠ¤íŠ¸ íŒŒì¼ ë¶„ë¥˜:**
    -   **ëª©í‘œ:** `src/api/tests` í´ë” ë‚´ì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤ì„ `unit`, `integration`, `e2e` í•˜ìœ„ í´ë”ë¡œ ì ì ˆíˆ ì´ë™ ë° ë¶„ë¥˜í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ê´€ë¦¬ ìš©ì´ì„±ì„ ë†’ì…ë‹ˆë‹¤.
    -   **ì„¸ë¶€ ê³„íš:**
        1.  `src/api/tests` ê²½ë¡œì— ìˆëŠ” `test_admin_scheduler.py`, `test_seed_data.py` ë“±ì˜ íŒŒì¼ì„ ë‚´ìš©ì— ë”°ë¼ `unit` ë˜ëŠ” `integration` í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
        2.  ì´ë™ í›„, ê° í…ŒìŠ¤íŠ¸ íŒŒì¼ì˜ `import` ê²½ë¡œ ë° ê´€ë ¨ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        3.  ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

## ğŸ 2025-08-31: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì ê²€ ë° ìˆ˜ì • ê³¼ì œ

-   **ì ê²€ ìš”ì•½:**
    -   âœ… **`common` ëª¨ë“ˆ:** í…ŒìŠ¤íŠ¸ 15ê°œ ëª¨ë‘ **í†µê³¼**.
    -   âœ… **`api` ëª¨ë“ˆ:** `src/api/tests/unit/test_predict_service.py` ì˜ ëª¨ë“  í…ŒìŠ¤íŠ¸ **í†µê³¼** (ë©ˆì¶¤ ë¬¸ì œ í•´ê²°).
    -   âœ… **`bot` ëª¨ë“ˆ:** ëª¨ë“  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ **í†µê³¼**.
    -   âœ… **`worker` ëª¨ë“ˆ:** í…ŒìŠ¤íŠ¸ 6ê°œ ëª¨ë‘ **í†µê³¼**.

-   **ìˆ˜ì • ê³¼ì œ ëª©ë¡:**
    -   [x] **`api` ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ í–‰(hang) ë¬¸ì œ í•´ê²°:** `src/api/tests/unit/test_predict_service.py` ì‹¤í–‰ ì‹œ ë°œìƒí•˜ëŠ” ë¬´í•œ ëŒ€ê¸° í˜„ìƒì„ ë¶„ì„í•˜ê³  ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
    -   [x] **`bot` ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ìˆ˜ì •:** `src/bot/tests/unit/test_alert_handler.py`ì˜ `test_alert_list_success` í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ëŠ” ì›ì¸ì„ ë¶„ì„í•˜ê³  ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

# TODO List for StockEyeDev Integration Test Normalization

## High Priority

- [x] **Fix User Creation Issues in Tests:**
    - [x] Modify `src/api/tests/helpers.py`: Change `password_hash` to `hashed_password` in `create_test_user`.
    - [x] Modify `src/api/tests/conftest.py`: Import `UserCreate` and use it when calling `user_service.create_user` in `test_user` fixture.
- [x] **Fix `test_price_alert_service_integration.py` User Creation Issue:**
    - [x] Change `password_hash` to `hashed_password` in direct `User` instantiation.

## Medium Priority

- [ ] **Address `404 Not Found` Errors (Route Issues) in `test_api_admin_integration.py`:**
    - [x] Prepend `/api/v1` to all admin routes in `test_api_admin_integration.py`.
    - [x] Change `assert response.status_code == 401` to `assert response.status_code == 403` for unauthenticated tests.
    - [x] Fix `ModuleNotFoundError` in `@patch` decorators by correcting import paths.
    - [ ] **Fix `IndentationError` in `test_api_admin_integration.py` after commenting out scheduler tests.**
    - [ ] **Fix `test_update_disclosure_single_by_symbol_success_as_admin` message assertion.**
    - [ ] **Fix `test_update_disclosure_not_found_as_admin` mock.**

- [ ] **Fix `test_notification_publish_integration.py` Login Request Body:**
    - Change login request in test to send JSON instead of form data.

- [ ] **Fix `test_db_schema_integration.py` Type Mismatch:**
    - Adjust type comparison in test or ensure consistent type definitions for DATETIME/TIMESTAMP.

## Low Priority

- [ ] **Address `test_api_stock_master_integration.py` Missing Fixture:**
    - Find or create the `override_stock_service_dependencies` fixture.

- [ ] **Address `test_api_alerts_integration.py` Pydantic `model_validate` Issue:**
    - Investigate Pydantic version and correct `model_validate` usage.

- [ ] **Re-evaluate `test_stock_service_integration.py` Timeout:**
    - Re-run test after other fundamental issues are resolved to see if timeouts persist.

- [ ] **Comment out scheduler-related tests in `test_api_admin_integration.py`:**
    - This is a temporary measure to isolate issues. These tests will be re-enabled/fixed once the worker service is stable.